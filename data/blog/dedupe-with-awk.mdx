---
title: 'awkで重複行を削除'
date: '2021-11-11'
tags: ['shellscript', 'awk']
draft: false
summary: 'awkコマンドを使用してファイルの重複行を削除したファイルを作成'
---

# 概要

awk コマンドを使用し、ファイルの重複行を削除したファイルを作成する。

## 具体例

- 以下のような csv ファイルを想定。

```csv
"住所CD","都道府県CD","市区町村CD","町域CD","郵便番号","事業所フラグ","廃止フラグ","都道府県","都道府県カナ","市区町村","市区町村カナ","町域","町域カナ","町域補足","京都通り名","字丁目","字丁目カナ","補足","事業所名","事業所名カナ","事業所住所","新住所CD"
101006101,13,13101,131010056,"101-0061",0,1,"東京都","トウキョウト","千代田区","チヨダク","三崎町",,,,,,,,,,
101006101,13,13101,131010056,"101-0061",0,1,"東京都","トウキョウト","千代田区","チヨダク","三崎町",,,,,,,,,,
101850100,13,13101,131010004,"101-8501",1,0,"東京都","トウキョウト","千代田区","チヨダク","内神田","ウチカンダ",,,,,,"全国農業協同組合連合会全農東京支所","ゼンコクノウギヨウキヨウドウクミアイレンゴウカイゼンノウトウキヨウシシヨ","内神田１丁目１－１２",
112858500,13,13105,131050006,"112-8585",1,0,"東京都","トウキョウト","文京区","ブンキョウク","小日向","コヒナタ",,,,,,"学校法人　拓殖大学（文京キャンパス）","ガツコウホウジン　タクシヨクダイガク（ブンキヨウキヤンパス）","小日向３丁目４－１４",
141003100,13,13109,131090012,"141-0031",0,0,"東京都","トウキョウト","品川区","シナガワク","西五反田","ニシゴタンダ",,,,,,,,,
142855500,13,13109,131090015,"142-8555",1,0,"東京都","トウキョウト","品川区","シナガワク","旗の台","ハタノダイ",,,,,,"昭和大学","シヨウワダイガク","旗の台１丁目５－８",
151857800,13,13113,131130031,"151-8578",1,0,"東京都","トウキョウト","渋谷区","シブヤク","代々木","ヨヨギ",,,,,,"ＪＲ東日本　（株）　本社","ジエイア－ルヒガシニホン　カブシキガイシヤ　ホンシヤ","代々木２丁目２－２",
151857800,13,13113,131130031,"151-8578",1,0,"東京都","トウキョウト","渋谷区","シブヤク","代々木","ヨヨギ",,,,,,"ＪＲ東日本　（株）　本社","ジエイア－ルヒガシニホン　カブシキガイシヤ　ホンシヤ","代々木２丁目２－２",

```

- 同内容の行を削除

```shell
cat address.csv | awk '!colname[$0]++' > address-new.csv

cat address-new.csv
# "住所CD","都道府県CD","市区町村CD","町域CD","郵便番号","事業所フラグ","廃止フラグ","都道府県","都道府県カナ","市区町村","市区町村カナ","町域","町域カナ","町域補足","京都通り名","字丁目","字丁目カナ","補足","事業所名","事業所名カナ","事業所住所","新住所CD"
# 101006101,13,13101,131010056,"101-0061",0,1,"東京都","トウキョウト","千代田区","チヨダク","三崎町",,,,,,,,,,
# 101850100,13,13101,131010004,"101-8501",1,0,"東京都","トウキョウト","千代田区","チヨダク","内神田","ウチカンダ",,,,,,"全国農業協同組合連合会全農東京支所","ゼンコクノウギヨウキヨウドウクミアイレンゴウカイゼンノウトウキヨウシシヨ","内神田１丁目１－１２",
# 112858500,13,13105,131050006,"112-8585",1,0,"東京都","トウキョウト","文京区","ブンキョウク","小日向","コヒナタ",,,,,,"学校法人　拓殖大学（文京キャンパス）","ガツコウホウジン　タクシヨクダイガク（ブンキヨウキヤンパス）","小日向３丁目４－１４",
# 141003100,13,13109,131090012,"141-0031",0,0,"東京都","トウキョウト","品川区","シナガワク","西五反田","ニシゴタンダ",,,,,,,,,
# 142855500,13,13109,131090015,"142-8555",1,0,"東京都","トウキョウト","品川区","シナガワク","旗の台","ハタノダイ",,,,,,"昭和大学","シヨウワダイガク","旗の台１丁目５－８",
# 151857800,13,13113,131130031,"151-8578",1,0,"東京都","トウキョウト","渋谷区","シブヤク","代々木","ヨヨギ",,,,,,"ＪＲ東日本　（株）　本社","ジエイア－ルヒガシニホン　カブシキガイシヤ　ホンシヤ","代々木２丁目２－２",
```

- 同じ市区町村(10 カラム目)の行を削除

最初に千代田区が読み込まれた後 `colname['千代田区']`がインクリメントされ 1 になる。  
つまり、`!colname['千代田区']` は false となり、その後は出力されない。

```shell
cat address.csv | awk -F , '!colname[$10]++' > address-new.csv

cat address-new.csv
# "住所CD","都道府県CD","市区町村CD","町域CD","郵便番号","事業所フラグ","廃止フラグ","都道府県","都道府県カナ","市区町村","市区町村カナ","町域","町域カナ","町域補足","京都通り名","字丁目","字丁目カナ","補足","事業所名","事業所名カナ","事業所住所","新住所CD"
# 101006101,13,13101,131010056,"101-0061",0,1,"東京都","トウキョウト","千代田区","チヨダク","三崎町",,,,,,,,,,
# 112858500,13,13105,131050006,"112-8585",1,0,"東京都","トウキョウト","文京区","ブンキョウク","小日向","コヒナタ",,,,,,"学校法人　拓殖大学（文京キャンパス）","ガツコウホウジン　タクシヨクダイガク（ブンキヨウキヤンパス）","小日向３丁目４－１４",
# 141003100,13,13109,131090012,"141-0031",0,0,"東京都","トウキョウト","品川区","シナガワク","西五反田","ニシゴタンダ",,,,,,,,,
# 151857800,13,13113,131130031,"151-8578",1,0,"東京都","トウキョウト","渋谷区","シブヤク","代々木","ヨヨギ",,,,,,"ＪＲ東日本　（株）　本社","ジエイア－ルヒガシニホン　カブシキガイシヤ　ホンシヤ","代々木２丁目２－２",

```
